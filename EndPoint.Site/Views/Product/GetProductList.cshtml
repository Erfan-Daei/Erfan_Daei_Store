@using Practice_Store.Application.Services.Products.Queries.GetProductList_Site
@model ResultGetProductList_SiteDto;
@addTagHelper *, LazZiya.TagHelpers
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "GetProductList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="space-top space-extra-bottom">
    <div class="container">
        <div class="th-sort-bar">
            <div class="row justify-content-between align-items-center">
                @{
                    int firstIndex = (Model.CurrentPage - 1) * Model.PageSize + 1; 
                    int lastIndex = Math.Min(Model.CurrentPage * Model.PageSize, Model.RowsCount);
                }
                <div class="col-md"><p class="woocommerce-result-count">نمایش @firstIndex-@lastIndex از @Model.RowsCount محصول</p></div>
                <div class="col-md-auto">
                    <form class="woocommerce-ordering" method="get">
                        <select name="orderbySelect" id="orderbySelect" class="orderby" aria-label="Shop order">
                            <option value="select0" data-href="/Product/GetProductList?SearchKey=@Context.Request.Query["SearchKey"]&CategoryId=@Context.Request.Query["CategoryId"]&ordering=0" selected>مرتب سازی پیش فرض</option>
                            <option value="select1" data-href="/Product/GetProductList?SearchKey=@Context.Request.Query["SearchKey"]&CategoryId=@Context.Request.Query["CategoryId"]&ordering=1">مرتب سازی بر پربازدید ترین</option>
                            <option value="select2" data-href="/Product/GetProductList?SearchKey=@Context.Request.Query["SearchKey"]&CategoryId=@Context.Request.Query["CategoryId"]&ordering=2">مرتب سازی بر جدیدترین</option>
                            <option value="select3" data-href="/Product/GetProductList?SearchKey=@Context.Request.Query["SearchKey"]&CategoryId=@Context.Request.Query["CategoryId"]&ordering=3">گران ترین</option>
                            <option value="select4" data-href="/Product/GetProductList?SearchKey=@Context.Request.Query["SearchKey"]&CategoryId=@Context.Request.Query["CategoryId"]&ordering=4">ارزان ترین</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
        <div class="row gy-40">
            @foreach(var item in Model.ProductList){
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="th-product product-grid">
                        @if (item.OffPercentage > 0){

                            <div class="product-img">
                                <img src="~/@item.ImageSrc" alt="Product Image"><span class="product-tag">@item.OffPercentage%</span><div class="actions">
                                    <a href="#QuickView" class="icon-btn popup-content"><i class="far fa-eye"></i></a><a href="cart.html" class="icon-btn"><i class="far fa-cart-plus"></i></a><a href="wishlist.html" class="icon-btn"><i class="far fa-heart"></i></a>
                                </div>
                            </div>
                            <div class="product-content">
                                <a href="shop-details.html" class="product-category">@item.Brand</a><h3 class="product-title"><a href="/product/GetProductDetail/@item.Id">@item.Name</a></h3>
                                <span class="price">@((item.Price - (item.Price * item.OffPercentage / 100)).ToString("n0"))<del>@item.Price.ToString("n0")</del></span>
                                <div class="woocommerce-product-rating">
                                    <span class="count">(@item.ProductReviewCount نظر)</span><div class="star-rating" role="img" aria-label="Rated 5.00 out of 5">
                                        <span>
                                            @for (int i = 0; i < item.ProductScore; i++)
                                            {
                                                <a class="star active" href="#">30</a>
                                            }
                                        </span>
                                    </div>
                                </div>
                            </div>

                        }
                        else{

                            <div class="product-img">
                                <img src="~/@item.ImageSrc" alt="Product Image"><div class="actions">
                                    <a href="#QuickView" class="icon-btn popup-content"><i class="far fa-eye"></i></a><a href="cart.html" class="icon-btn"><i class="far fa-cart-plus"></i></a><a href="wishlist.html" class="icon-btn"><i class="far fa-heart"></i></a>
                                </div>
                            </div>
                            <div class="product-content">
                                <a href="shop-details.html" class="product-category">@item.Brand</a><h3 class="product-title"><a href="/product/GetProductDetail/@item.Id">@item.Name</a></h3>
                                <span class="price">@item.Price.ToString("n0")</span>
                                <div class="woocommerce-product-rating">
                                    <span class="count">(@item.ProductReviewCount نظر)</span><div class="star-rating" role="img" aria-label="Rated 5.00 out of 5">
                                        <span>
                                            @for (int i = 0; i < item.ProductScore; i++)
                                            {
                                                <a class="star active" href="#">30</a>
                                            }
                                        </span>
                                    </div>
                                </div>
                            </div>

                        }
                    </div>
                </div>
            }
        </div>
        <div class="text-center">
            <paging total-records="Model.RowsCount"
                    page-no="Model.CurrentPage"
                    page-size="Model.PageSize"
                    max-displayed-pages="Convert.ToInt16(Model.RowsCount/Model.PageSize)+1"
                    show-first-last="true"
                    show-prev-next="true"
                    show-total-pages="false"
                    show-total-records="false"
                    show-page-size-nav="false"
                    show-gap="true"
                    query-string-key-page-no="Page"
                    query-string-key-page-size="PageSize">
            </paging>

        </div>
    </div>
</section>

@section Scripts {

    <script>
        $(document).ready(function() { $('#orderbySelect').change(function() { var selectedOption = $(this).find('option:selected'); var href = selectedOption.data('href'); if (href) { window.location.href = href; } }); });

        $(document).ready(function() {
            $('#orderbySelect').val("select"+'@Context.Request.Query["ordering"]');
        });
    </script>
}